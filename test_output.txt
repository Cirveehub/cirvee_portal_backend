npm warn Unknown user config "fetch-retry-mintime". This will stop working in the next major version of npm.
npm warn Unknown user config "fetch-retry-maxtime". This will stop working in the next major version of npm.

> portal_backend@1.0.0 test
> dotenv -e .env.test -- jest --runInBand --detectOpenHandles src/tests/queue.test.ts

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.test -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

2025-12-30 08:34:56 [32minfo[39m: Redis connected 
2025-12-30 08:34:56 [32minfo[39m: Redis is ready to accept commands
  console.log
    Job added: 4

      at Object.<anonymous> (src/tests/queue.test.ts:30:17)

  console.log
    Queue counts: {
      active: 0,
      completed: 0,
      delayed: 0,
      failed: 3,
      paused: 0,
      prioritized: 0,
      waiting: 1,
      'waiting-children': 0
    }

      at Object.<anonymous> (src/tests/queue.test.ts:34:17)

  console.log
    Worker running? true

      at Object.<anonymous> (src/tests/queue.test.ts:35:17)

2025-12-30 08:35:00 [32minfo[39m: Processing email job 4 of type VERIFICATION
2025-12-30 08:35:00 [31merror[39m: Failed to process email job 4: Cannot read properties of undefined (reading 'email')
2025-12-30 08:35:00 [31merror[39m: Email job 4 failed: Cannot read properties of undefined (reading 'email')
2025-12-30 08:35:02 [32minfo[39m: Processing email job 4 of type VERIFICATION
2025-12-30 08:35:02 [31merror[39m: Failed to process email job 4: Cannot read properties of undefined (reading 'email')
2025-12-30 08:35:02 [31merror[39m: Email job 4 failed: Cannot read properties of undefined (reading 'email')
2025-12-30 08:35:04 [32minfo[39m: Processing email job 4 of type VERIFICATION
2025-12-30 08:35:04 [31merror[39m: Failed to process email job 4: Cannot read properties of undefined (reading 'email')
2025-12-30 08:35:05 [31merror[39m: Email job 4 failed: Cannot read properties of undefined (reading 'email')
  console.log
    Queue counts after wait: {
      active: 0,
      completed: 0,
      delayed: 0,
      failed: 4,
      paused: 0,
      prioritized: 0,
      waiting: 0,
      'waiting-children': 0
    }

      at Object.<anonymous> (src/tests/queue.test.ts:40:17)

FAIL src/tests/queue.test.ts (20.451 s)
  Queue System
    â”œÃ¹ should process email jobs (5925 ms)

  Î“Ã¹Ã… Queue System Î“Ã‡â•‘ should process email jobs

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "test@queue.com", "Queue Test", "123456"

    Number of calls: 0

      40 |         console.log("Queue counts after wait:", countsAfter);
      41 |
    > 42 |         expect(sendSpy).toHaveBeenCalledWith(payload.email, payload.name, payload.otp);
         |                         ^
      43 |     }, 20000);
      44 | });
      45 |

      at Object.<anonymous> (src/tests/queue.test.ts:42:25)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 1 total
Snapshots:   0 total
Time:        21.412 s
Ran all test suites matching src/tests/queue.test.ts.
