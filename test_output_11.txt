npm warn Unknown user config "fetch-retry-mintime". This will stop working in the next major version of npm.
npm warn Unknown user config "fetch-retry-maxtime". This will stop working in the next major version of npm.

> portal_backend@1.0.0 test
> dotenv -e .env.test -- jest --runInBand --detectOpenHandles src/tests/queue.test.ts

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.test -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

2025-12-30 09:13:37 [32minfo[39m: Redis connected 
2025-12-30 09:13:37 [32minfo[39m: Redis is ready to accept commands
  console.log
    Test 1 Job added: 1

      at Object.<anonymous> (src/tests/queue.test.ts:38:17)

  console.log
    Test 2 Job added: 2

      at Object.<anonymous> (src/tests/queue.test.ts:66:17)

  console.log
    Test 2 Queue counts: {
      active: 0,
      completed: 1,
      delayed: 0,
      failed: 0,
      paused: 0,
      prioritized: 0,
      waiting: 1,
      'waiting-children': 0
    }

      at Object.<anonymous> (src/tests/queue.test.ts:69:17)

  console.log
    Test 2 Queue counts after: {
      active: 0,
      completed: 2,
      delayed: 0,
      failed: 0,
      paused: 0,
      prioritized: 0,
      waiting: 0,
      'waiting-children': 0
    }

      at Object.<anonymous> (src/tests/queue.test.ts:73:17)

  console.log
    Test 3 Job added: 3

      at Object.<anonymous> (src/tests/queue.test.ts:103:17)

2025-12-30 09:13:56 [32minfo[39m: Processing email job 3 of type ANNOUNCEMENT_NEW
  console.log
    MOCK sendAnnouncementEmail called!

      at Function.<anonymous> (src/tests/queue.test.ts:95:21)

2025-12-30 09:13:56 [32minfo[39m: Email job 3 completed
FAIL src/tests/queue.test.ts (41.649 s)
  Queue System
    â”œÃ¹ should process email jobs (8300 ms)
    â”œÃ¹ should process assignment creation emails (8769 ms)
    Î“ÃªÃœ should process announcement emails (8288 ms)

  Î“Ã¹Ã… Queue System Î“Ã‡â•‘ should process email jobs

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "test@queue.com", "Queue Test", "123456"

    Number of calls: 0

      39 |
      40 |         await new Promise(resolve => setTimeout(resolve, 8000));
    > 41 |         expect(mockFn).toHaveBeenCalledWith(payload.email, payload.name, payload.otp);
         |                        ^
      42 |     }, 30000);
      43 |
      44 |     it("should process assignment creation emails", async () => {

      at Object.<anonymous> (src/tests/queue.test.ts:41:24)

  Î“Ã¹Ã… Queue System Î“Ã‡â•‘ should process assignment creation emails

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "student@test.com", "Student", "Test Assignment", "Test Course", Anything

    Number of calls: 0

      73 |         console.log(`Test 2 Queue counts after:`, await queue.getJobCounts());
      74 |
    > 75 |         expect(mockFn).toHaveBeenCalledWith(
         |                        ^
      76 |             payload.email, 
      77 |             payload.studentName, 
      78 |             payload.assignmentTitle, 

      at Object.<anonymous> (src/tests/queue.test.ts:75:24)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 1 passed, 3 total
Snapshots:   0 total
Time:        42.518 s, estimated 51 s
Ran all test suites matching src/tests/queue.test.ts.
