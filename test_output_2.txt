npm warn Unknown user config "fetch-retry-mintime". This will stop working in the next major version of npm.
npm warn Unknown user config "fetch-retry-maxtime". This will stop working in the next major version of npm.

> portal_backend@1.0.0 test
> dotenv -e .env.test -- jest --runInBand --detectOpenHandles src/tests/queue.test.ts

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.test -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

2025-12-30 08:56:08 [32minfo[39m: Redis connected 
2025-12-30 08:56:09 [32minfo[39m: Redis is ready to accept commands
  console.log
    Job added: 6

      at Object.<anonymous> (src/tests/queue.test.ts:30:17)

  console.log
    Queue counts: {
      active: 0,
      completed: 1,
      delayed: 0,
      failed: 4,
      paused: 0,
      prioritized: 0,
      waiting: 1,
      'waiting-children': 0
    }

      at Object.<anonymous> (src/tests/queue.test.ts:34:17)

  console.log
    Worker running? true

      at Object.<anonymous> (src/tests/queue.test.ts:35:17)

  console.log
    Queue counts after wait: {
      active: 0,
      completed: 2,
      delayed: 0,
      failed: 4,
      paused: 0,
      prioritized: 0,
      waiting: 0,
      'waiting-children': 0
    }

      at Object.<anonymous> (src/tests/queue.test.ts:40:17)

2025-12-30 08:56:16 [32minfo[39m: Processing email job 7 of type ASSIGNMENT_CREATED
2025-12-30 08:56:16 [32minfo[39m: Email job 7 completed
FAIL src/tests/queue.test.ts (34.509 s)
  Queue System
    â”œÃ¹ should process email jobs (5942 ms)
    Î“ÃªÃœ should process assignment creation emails (5498 ms)
    â”œÃ¹ should process announcement emails (5284 ms)

  Î“Ã¹Ã… Queue System Î“Ã‡â•‘ should process email jobs

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "test@queue.com", "Queue Test", "123456"

    Number of calls: 0

      40 |         console.log("Queue counts after wait:", countsAfter);
      41 |
    > 42 |         expect(sendSpy).toHaveBeenCalledWith(payload.email, payload.name, payload.otp);
         |                         ^
      43 |     }, 20000);
      44 |
      45 |     it("should process assignment creation emails", async () => {

      at Object.<anonymous> (src/tests/queue.test.ts:42:25)

  Î“Ã¹Ã… Queue System Î“Ã‡â•‘ should process announcement emails

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "student@test.com", "Student", "Test Announcement", "Content", "Admin"

    Number of calls: 0

      88 |         await new Promise(resolve => setTimeout(resolve, 5000));
      89 |
    > 90 |         expect(sendSpy).toHaveBeenCalledWith(
         |                         ^
      91 |             payload.email, 
      92 |             payload.name, 
      93 |             payload.title, 

      at Object.<anonymous> (src/tests/queue.test.ts:90:25)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 1 passed, 3 total
Snapshots:   0 total
Time:        35.858 s
Ran all test suites matching src/tests/queue.test.ts.

